# JednoprolazniAsembler
projekat iz predmeta Softverski sistemi
## Opis rešenja
Prilikom pokretanja programa potrebno je upisati pet argumenata na standardni ulaz u obliku asembler -o izlaz.o ulaz.s. Poslednja dva argumenta predstavljaju izlazni i ulazni fajl. Iako su ekstenzije fajova .o i .s, program radi sa tekstualnim fajlovima, odnosno ignoriše potpuno ekstenzije date kao argumente programa. Ulazni fajl mora da postoji pre pokretanja programa, dok se izlazni fajl sam napravi, i u slučaju da se program korektno izvrši, u izlazni fajl se upisuje određeni tekst. U slučaju da je program uspešno pokrenut, iz ulaznog fajla se čita slovo po slovo i od tih slova se prave reči, tako što se nakon detektovanog razmaka ili specijalnog znaka (zarez, plus i minus) od trenutnog niza slova napravi reč i ta reč se stavi u listu reči. Pošto je bitno da se pamti kojoj liniji pripada reč, lista reči se nakon svakog novog reda stavlja u listu redova (lista listi reči). Nakon isčitanog ulaznog fajla, program počinje asembliranje, tako što obrađuje liniju po liniju ulaznog fajla.
Što se tiče labela, u jednom redu je najviše dozvoljena jedna labela, potencijalno prateća nekom instrukcijom ili direktivom (osim .end direktive). Labela se pamti u tabeli simbola bez navedene dvotačke. U tabeli simbola se čuvaju naziv simbola, redni broj sekcije u kojoj se nalaze, pomeraj u odnosu na sekciju, veličina sekcije (kod ostalih simbola je 0), opseg (lokalni ili globalni), da li je simbol definisan, fleg za određenu sekciju, da li je simbol eksteran, lista obraćanja unapred (lista se sastoji od strukture koja u sebi ima pomeraj unutar sekcije, koliko bajtova zauzima i na koju sekciju se pomeraj odnosi) i lista koja služi za razrešavanje simbola definisanih .equ direktivom (biće kasnije objašnjeno). Direktive .global i .extern se moraju navesti pre prvog korišćenja. U slučaju da se navede .global direktiva, simbol naveden unutar date direktive se mora definisati kasnije. Ove dve direktive se mogu navesti unutar sekcija ili van sekcija. Direktive .byte i .word moraju biti unutar neke od sekcija i može se navesti više simbola (kao i kod .global i .extern direktiva) i literala. To je implementirano tako što se brojač namesti na nulu i prolazi se kroz listu reči datog reda. Kada je brojač paran, tada se obrađuje simbol, u suprotnom je reč o zarezu. Ako se naiđe na simbol koji još nije definisan (niti je naveden unutar .extern direktive), onda se taj simbol stavšlja u tabelu simbola kao nedefinisan i u listu obraćanja unapred se stavlja gde treba da se prepravi to mesto. U slučaju da je simbol naveden unutar .extern direktive, tada nema potrebe za listom obraćanja unapred. Dozvoljene sekcije unutar programa su .text, .data i .bss. Unutar .text sekcije su dozvoljene sve direktive i instrukcije, unutar .data sekcije nisu dozvoljene samo instrukcije, dok unutar .bss sekcije nisu još dodatno dozvoljene direktive .byte i .word. Za pamćenje mašinskog koda postoji klasa koja se sastoji od liste char-ova i od naziva sekcije. U listu char-ova se stavljaju char-ovi kada se naiđe na neku instrukciju ili direktivu koja zauzima memorijski prostor, dok se sadržaj u njoj menja kada se naiđe na novu labelu i razreši obraćanje unapred za tu labelu i simbole definisane .equ direktivom (ako je to moguće u datom trenutku). Svaka sekcija ima svoj određeni fleg. Takođe, nazivi sekcija se mogu koristiti unutar .byte i .word direktiva (nicu dozvoljeni unutar instrukcija). U slučaju da se unutar direktiva .byte i .word pojavljuje simbol, mora se navesti relokacioni zapis u relokacionu tabelu kao apsolutno adresiranje. Relokacioni zapis se sastoji od pomeraja unutar sekcije, naziva adresiranja (apsolutno-R_386_32, relativno- R_386_PC32), rednog broja sekcije, odnosno simbola, u zavisnosti od toga da li je simbol globalan ili lokalan, i od pokazivača na simbol na koji se odnosi relokacioni zapis. Pokazivač na simbol je uveden da bi se mogao ažurirati redni broj simbola, odnosno sekcije kod relokacionog zapisa. Relokaciona tabela se sastoji od liste relokacionih zapisa i od naziva sekcije kojoj pripada ova tabela. Relokacioni zapisi se takođe dodaju i kod pojave simbola kod instrukcija, s tim što kod instrukcija može da dođe do oba tipa adresiranja. Do relativnog adresiranja dolazi kod registarskog indirektnog adresiranja sa pomerajem kada se koristi simbol kao pomeraj i registar r7 koji zapravo predstavlja pc registar. U slučaju dvoadresne instrukcije, pomeraj od trenutne vrednosti location counter-a do sledeće instrukcije može iznositi -2,-3,-4 i -5, u zavisnosti od veličine instrukcije i tipa adresiranja, dok kod jednoadresnih instrukcija ta vrednost može iznositi samo -2. Kod .equ direktive, navode se simbol i izraz odvojeni zarezom. Izraz se pokuša razrešiti iz prve, dok se simbol svakako stavlja u tabelu simbola. Ako se ne uspe, onda se taj izraz pamti u već pomenutoj listi za razrešavanje .equ direktive. Svaki put kada se definiše novi simbol, pokušaju se razrešiti i svi simboli definisani .equ direktivom. Sekcija simbola definisana .equ direktivom se određuje tako što se sabiraju i oduzimaju sve sekcije simbola navedenih u izrazu. U slučaju da se dobije vrednost 0, simbol će pripadati sekciji u kojoj se nalazi. Slično se određuje i opseg simbola. Simbol definisan .equ direktivom se ne navodi u .global i .extern direktivama. Sve suprotno od ovde navedenog, program će tumačiti kao grešku i ispisati je na standardan izlaz.
